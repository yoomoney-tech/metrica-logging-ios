# metrica-logging-ios
## Проект для ознакомления с инструментом автоматизации тестов продуктовых метрик в UI-тестах на iOS

Доклад по данному инструменту с конференции ЮMoney day: (ссылка будет доступна после публикации видеоматериалов с конференции)

### Установка зависимостей
Для того чтоб работали тесты необходимо запустить скрипт стриминга системных логов. 
Запуск скрипта выполняется на основе утилиты rake

Если в системе нет утилиты Rake, то ее можно установить через bundler.
В gemfile проекта прописана нужная версия rake, поэтому достаточно вызвать из папки проекта команду в консоли 
```bundle```  

Если же и bundler отсутствует, его можно установить командой 
```gem install bundler```  

### Запуск скрипта
Для запуска скрипта нужно выполнить консольную команду из папки проекта 

```rake ios_simulator_system_log:start ru.yoo.money.MetricaLogging YooMetrica```

где "ru.yoo.money.MetricaLogging" это subsystem, а "YooMetrica" - category событий системного лога.
Также команда поддерживает дополнительные параметры, если вы хотите изменить путь сохранения логов и имя папки, в которую они будут сохраняться 

Все доступные аргументы: 
    
    1 - subsystem
    2 - category
    3 - directory for logs (optional)
    4 - root directory (optional)
Пример запуска команды с полным набором аргументов:

```rake ios_simulator_system_log:start ru.yoo.money.MetricaLogging YooMetrica Logs usr/projects/some_project_name```    

### Запуск тестирования метрик
Если выполнен предыдущий шаг, можно со спокойной душой запускать ui тесты и наблюдать как тестируется метрика...

### Как все работает
1) Rakefile содержит в себе скрипты на языке Ruby, которые запускают стриминг системного лога в файл логов проекта.
2) В основном таргете проекта в папки Events содержится набор событий которые отправляются во всевозможные метрики. Каждое событие имеет в свойствах набор трекеров, в которые оно должно быть отправлено.
3) В папке Tracker находится реализация трекеров и файл TrackersContainer, который в себе содержит набор всех трекеров и умеет отправлять события во все указанные системы аналитики.
4) В таргете UI-тестов находится папка Common/Models в которой есть реализация дебажного события с удобным инициализатором параметров
5) В папке Services находится провайдер чтения логов из файла, в который записывает стрим, запущенный в первом пункте.  

### Контакты
Если возникнут вопросы по реализации, присылайте их по следующим контактам:

email: zelikson@yoomoney.ru
social networks(tg, vk, inst, twitter, etc...): @aktubuct
